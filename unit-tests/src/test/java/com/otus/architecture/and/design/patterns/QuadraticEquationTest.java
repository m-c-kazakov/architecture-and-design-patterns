package com.otus.architecture.and.design.patterns;

import com.otus.architecture.and.design.patterns.exceptions.IncorrectValueException;
import com.otus.architecture.and.design.patterns.exceptions.NotZeroException;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;


class QuadraticEquationTest {

    private final QuadraticEquation quadraticEquation = new QuadraticEquation();

    @Test
    @DisplayName("x^2+1 = 0: корней нет (возвращается пустой массив)")
    void solve$1() {

        // Arrange
        double a = 1;
        double b = 0;
        double c = 1;

        // Act
        double[] result = quadraticEquation.solve(a, b, c);

        // Assert
        assertEquals(0, result.length, "Ожидалось что корней не будет");
    }

    @Test
    @DisplayName("x^2-1 = 0: есть два корня кратности 1 (x1=1, x2=-1)")
    void solve$2() {

        // Arrange
        double a = 1;
        double b = 0;
        double c = -1;

        // Act
        double[] result = quadraticEquation.solve(a, b, c);

        // Assert
        assertEquals(2, result.length, "Ожидалось 2 корня");
        assertEquals(1, result[0],  "Ожидаемый результат x1 = 1");
        assertEquals(-1, result[1],  "Ожидаемый результат x2 = -1");
    }

    @Test
    @DisplayName("x^2+2x+1 = 0: eсть один корень кратности 2 (x1= x2 = -1)")
    void solve$3() {

        // Arrange
        double a = 1;
        double b = 2;
        double c = 1;

        // Act
        double[] result = quadraticEquation.solve(a, b, c);

        // Assert
        assertEquals(1, result.length, "Ожидался 1 корень");
        assertEquals(-1, result[0] , "Ожидаемый результат x1 = x2 = -1");
    }

    @Test
    @DisplayName("Коэффициент a не может быть равен 0")
    void solve$4() {

        // Arrange discriminant = Math.pow(0.01, 2) - 4 * 0.0002 * 1
        double a = 0;
        double b = 2;
        double c = 1;

        // Act
        // Assert
        assertThrows(NotZeroException.class, () -> quadraticEquation.solve(a, b, c), "Ожидаемый результат: NotZeroException");
    }

    @Test
    @DisplayName("Дискриминант был отличный от нуля, но меньше заданного эпсилон")
    void solve$5() {

        // Arrange Math.pow(2.191, 2) - 4 * 1 * 1.2
        double a = 1;
        double b = 2.191;
        double c = 1.2;

        // Act
        double[] result = quadraticEquation.solve(a, b, c);

        // Assert
        assertEquals(1, result.length, "Ожидался 1 корень");
        assertEquals(-1.0845341439002723, result[0] , "Ожидаемый результат x1 = x2 = -1.0845341439002723");
    }

    @DisplayName("Посмотреть какие еще значения могут принимать числа типа double")
    @ParameterizedTest
    @ValueSource(doubles = {Double.NaN, Double.POSITIVE_INFINITY, Double.NEGATIVE_INFINITY})
    void solve$6(double d) {

        // Arrange
        // Act
        // Assert
        assertThrows(IncorrectValueException.class, ()-> quadraticEquation.solve(d, d, d), "Ожидалось исключение IncorrectValueExceptionvz");
    }


}